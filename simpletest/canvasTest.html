<!DOCTYPE html>
<html lang="en">
<head>
	<title>canvas test</title>
	<style type="text/css">
		#pen-panel{
			border: 1px solid black;
        }
		#back-img{
			width: 400px;
		}
		#coordinates{
			position: relative;
		}
	</style>
</head>
<body>
	<img id="back" />
    <canvas id="pen-panel">
    </canvas>
    <p id="coordinates"></p>
    <a href="#" class="button" id="btn-download" download="maskLine.jpg">Download</a>
    <script type="text/javascript">
    
    var button = document.getElementById('btn-download');
    button.addEventListener('click', function (e) {
        var dataURL = canvas.toDataURL('image/jpg');
        button.href = dataURL; //////////////////////////// 마스크 라인 이미지 dataURL 저장시 이걸 활용 오네가이시마스!!
    });

    var pos = {drawable:false, x:0, y:0};
    var canvas = document.getElementById("pen-panel");
    var ctx = canvas.getContext("2d");
    ctx.strokeStyle = "#000"; //black stroke
    ctx.lineWidth = 1;
    var display = document.getElementById("coordinates");

    function listener(event){
        switch(event.type){
            case "mousedown":
                initDraw(event);
                break;
            case "mousemove":
                if(pos.drawable)
                    draw(event);
                break;
            case "mouseup":
                finishDraw();
                break;
        }
    }
    
    canvas.addEventListener("mousedown", listener);
    canvas.addEventListener("mousemove", listener);
    canvas.addEventListener("mouseup", listener);

    function initDraw(event){
        ctx.clearRect(0,0,canvas.width, canvas.height);
        ctx.beginPath();
        pos.drawable = true;
        var coors = getPosition(event);
        pos.x = coors.X;
        pos.y = coors.Y;
        ctx.moveTo(pos.x, pos.y);
    }
    function draw(event){
        var coors = getPosition(event);
        ctx.moveTo(pos.x, pos.y);
        ctx.lineTo(coors.X, coors.Y);
        pos.x=coors.X;
        pos.y=coors.Y;
        ctx.stroke();
        display.innerHTML = "X:"+coors.X+"  Y:"+coors.Y;
    }
    function finishDraw(){
        pos.drawable = false;
        pos.x=0;
        pos.y=0;
    }
    function getPosition(event){
        var x=event.pageX-canvas.offsetLeft;
        var y=event.pageY-canvas.offsetTop;
        return {X:x, Y:y};
    }

    var bgImg = new Image();
    bgImg.onload = function() {
        canvas.height = img.height;
        canvas.width = img.width;
        ctx.drawImage(img,0,0,img.width, img.height);
    };
    bgImg.src = "lena.jpg"; //////////////////////////////// content image url 만약 마스킹 이미지가 들어오면 여기서 업데이트       
    
</script>
</body>
</html>